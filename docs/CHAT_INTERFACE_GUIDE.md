# 聊天界面使用指南

## 📖 功能概述

聊天界面集成了两种 AI 对话模式：
1. **RAG 智能问答** - 基于知识库的检索增强生成
2. **Coze 工作流** - 调用 Coze AI 工作流

## 🎨 界面布局

### 左侧栏
- **模式切换**：RAG 问答 / Coze 工作流
- **RAG 模式**：显示会话列表
- **Coze 模式**：工作流配置

### 主聊天区域
- **消息显示**：支持 Markdown 渲染
- **代码高亮**：自动识别代码块并高亮
- **上下文显示**：查看检索到的文档片段
- **实时输入**：流式显示 AI 回复

## 🚀 使用方式

### 1. RAG 智能问答

#### 创建会话
1. 点击左上角 **新建对话** 按钮
2. 选择知识库
3. 配置检索选项：
   - **向量检索**：语义相似度检索
   - **图谱检索**：基于知识图谱的关系检索
   - **检索数量**：返回多少个相关文档片段（1-20）
4. 点击创建

#### 开始对话
1. 在输入框输入问题
2. 按 **Ctrl + Enter** 或点击发送按钮
3. AI 会实时流式返回答案
4. 点击 **查看检索上下文** 查看参考文档

#### 会话管理
- 点击左侧会话列表切换会话
- 每个会话独立存储历史记录
- 使用 **清空消息** 按钮清空当前对话

### 2. Coze 工作流

#### 配置工作流
1. 切换到 **Coze 工作流** 模式
2. 输入工作流 ID
3. 选择是否启用流式返回

#### 调用工作流
1. 输入问题或指令
2. 系统会自动调用配置的工作流
3. 实时显示工作流处理结果

## 💡 功能特性

### Markdown 支持
聊天界面完整支持 Markdown 语法：

#### 文本格式
```
**粗体文本**
*斜体文本*
~~删除线~~
`行内代码`
```

#### 代码块
````markdown
```python
def hello_world():
    print("Hello, World!")
```
````

#### 列表
```markdown
- 无序列表项 1
- 无序列表项 2

1. 有序列表项 1
2. 有序列表项 2
```

#### 表格
```markdown
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据1 | 数据2 | 数据3 |
```

#### 引用
```markdown
> 这是一段引用文本
> 可以多行
```

### 代码高亮

支持多种编程语言的语法高亮：
- Python
- JavaScript/TypeScript
- Java
- C/C++
- Go
- Rust
- SQL
- Shell
- 等等...

### 实时流式输出

- 使用 SSE (Server-Sent Events) 技术
- AI 回复逐字显示，无需等待完整响应
- 提供更好的用户体验

### 上下文查看

在 RAG 模式下，每条 AI 回复都会显示：
- 检索到的文档片段
- 文档标题和来源
- 相似度评分
- 方便验证答案的准确性

## 🎯 使用场景

### 场景 1：技术文档查询

**RAG 模式**：
```
用户：如何使用 FastAPI 创建 API？
AI：根据文档检索，创建 FastAPI API 的步骤如下...
    [查看检索上下文] → 显示相关文档片段
```

### 场景 2：数据分析

**RAG 模式**：
```
用户：分析一下最近的销售数据趋势
AI：基于知识库中的销售数据...
    • 增长率：15%
    • 主要市场：...
```

### 场景 3：工作流自动化

**Coze 模式**：
```
用户：北京今天应该穿什么衣服
AI：今天北京天气晴朗，但气温较低且有风，
    建议穿着厚外套、毛衣、保暖裤等保暖衣物...
```

### 场景 4：代码生成

**RAG 或 Coze 模式**：
````
用户：写一个 Python 函数计算斐波那契数列

AI：以下是一个计算斐波那契数列的 Python 函数：

```python
def fibonacci(n):
    """计算第 n 个斐波那契数"""
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# 使用示例
for i in range(10):
    print(f"F({i}) = {fibonacci(i)}")
```

这个函数使用递归方式实现...
````

## 🔧 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + Enter` | 发送消息 |
| `Esc` | 取消正在输入的消息 |

## 📊 消息元数据

每条 AI 回复都包含以下元数据：
- **Token 数量**：消耗的 Token 数
- **处理时间**：生成回复的耗时
- **检索上下文**：参考的文档片段（RAG 模式）

## ⚙️ 配置说明

### RAG 模式配置

**向量检索**：
- ✅ 启用：使用语义相似度检索
- ❌ 禁用：不使用向量检索

**图谱检索**：
- ✅ 启用：使用知识图谱关系检索
- ❌ 禁用：不使用图谱检索

**检索数量**：
- 范围：1-20
- 推荐：3-5（平衡准确性和响应速度）

### Coze 模式配置

**工作流 ID**：
- 在 Coze 平台获取
- 每个工作流对应特定功能

**流式返回**：
- ✅ 启用：实时显示结果
- ❌ 禁用：等待完整结果

## 🔍 故障排查

### 问题 1：无法创建会话

**可能原因**：
- 后端服务未启动
- 知识库不存在

**解决方案**：
```bash
# 启动后端服务
cd RAG_backend
python main.py

# 检查知识库
curl http://127.0.0.1:8000/api/v1/knowledge-bases
```

### 问题 2：消息无响应

**可能原因**：
- API 密钥未配置
- 网络连接问题

**解决方案**：
```bash
# 检查 .env 配置
cat .env | grep OPENAI_API_KEY
cat .env | grep COZE_API_KEY

# 查看后端日志
```

### 问题 3：Markdown 不渲染

**可能原因**：
- 依赖未安装

**解决方案**：
```bash
cd EmotionDrive
npm install markdown-it highlight.js
```

## 💡 最佳实践

1. **清晰的问题**：提问要具体明确
2. **合理的检索数量**：通常 3-5 个片段即可
3. **查看上下文**：验证 AI 回复的依据
4. **会话管理**：不同主题使用不同会话
5. **代码格式**：使用代码块标记代码

## 📱 响应式设计

界面已优化适配：
- 桌面端：完整功能
- 平板端：自适应布局
- 移动端：触摸优化

## 🎨 自定义样式

可以通过修改 CSS 变量自定义主题：
```css
.chat-page {
  --primary-color: #409eff;
  --message-bg: #f5f7fa;
  --code-bg: #282c34;
}
```

## 📚 相关文档

- [对话 API 文档](CHAT_API_GUIDE.md)
- [Coze 工作流指南](COZE_GUIDE.md)
- [后端 API 文档](API_DOCUMENTATION.md)

---

**提示**：开始愉快的 AI 对话之旅吧！🚀

